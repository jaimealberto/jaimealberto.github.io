<!DOCTYPE html>
<html class="no-js" lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Usuarios en Linux II, política de contraseñas - </title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Usuarios en Linux II">
		<meta property="og:title" content="Usuarios en Linux II, política de contraseñas" />
<meta property="og:description" content="Usuarios en Linux II" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jaimealberto.github.io/post/27_usuariosii/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-05-15T00:00:00+00:00" />


		<meta itemprop="name" content="Usuarios en Linux II, política de contraseñas">
<meta itemprop="description" content="Usuarios en Linux II"><meta itemprop="datePublished" content="2022-05-15T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-05-15T00:00:00+00:00" />
<meta itemprop="wordCount" content="909">
<meta itemprop="keywords" content="Terminal,Seguridad," />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/logo.png">
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menú</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">La causa ...</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/aboutme/">
				
				<span class="menu__text">Algo sobre mí ...</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">Posts</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/combos/">
				
				<span class="menu__text">Combos</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/raspberrypi/">
				
				<span class="menu__text">Raspberry Pi</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/vida/">
				
				<span class="menu__text">Vidas</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/recetas/">
				
				<span class="menu__text">Recetas</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/recursos/">
				
				<span class="menu__text">Recursos</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Usuarios en Linux II, política de contraseñas</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">JaimeAlberto</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2022-05-15T00:00:00Z">15-05-2022</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/sysadmin/" rel="category">Sysadmin</a>, <a class="meta__link" href="/categories/linux/" rel="category">Linux</a>
	</span>
</div></div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Índice</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#instalación">Instalación</a>
      <ul>
        <li><a href="#debian">Debian</a></li>
        <li><a href="#redhat">RedHat</a></li>
      </ul>
    </li>
    <li><a href="#ficheros-implicados">Ficheros implicados</a>
      <ul>
        <li><a href="#debian-1">Debian</a></li>
        <li><a href="#redhat-1">RedHat</a></li>
      </ul>
    </li>
    <li><a href="#configuración">Configuración</a>
      <ul>
        <li><a href="#valores-positivos-y-negativos">Valores positivos y negativos</a></li>
        <li><a href="#debian-2">Debian</a></li>
        <li><a href="#fedora">Fedora</a></li>
        <li><a href="#significado-de-los-valores">Significado de los valores</a></li>
        <li><a href="#para-tener-en-cuenta">Para tener en cuenta</a></li>
      </ul>
    </li>
    <li><a href="#chequeando-los-cambios">Chequeando los cambios</a></li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<p><figure><img src="/img/usuariosii.jpg"/>
</figure>

Como ya sabemos todos un <a href="https://es.wikipedia.org/wiki/Administrador_de_sistemas">administrador de sistemas</a> no descansa ni su <a href="https://es.wikipedia.org/wiki/Administrador_de_sistemas">día de celebración</a>. Todo el día luchando para resolver problemas de los usuarios, al fin de al cabo es su trabajo. Pero también tiene que implementar medidas que no son bien venidas por los usuarios.</p>
<p>La gestión de contraseñas es una de ellas y la aplicación de políticas sobre este tema no es plato de gusto. Ahora veremos algún procedimiento para hacer esto en nuestro día a día.</p>
<h1 id="pam-y-cracklib">PAM y Cracklib</h1>
<p>En Linux tenemos posibilidad de aplicar políticas de contraseñas obligando al usuario a cumplir una serie de requisitos, esto mejora bastante la seguridad del sistema.</p>
<p>Existen varias formas, en este caso usaremos el módulo <a href="https://es.wikipedia.org/wiki/Pluggable_Authentication_Modules">PAM (Pluggable Authentication Modules)</a> con la librería <a href="https://github.com/cracklib/cracklib">Cracklib</a>.</p>
<p>Existen multitud de parámetros y configuraciones distintas para aplicar el módulo PAM, pero aquí solo veremos una configuración base fuerte, a partir de la cual se podremos ir modificando y/o ampliando según nuestras necesidades.</p>
<h2 id="instalación">Instalación</h2>
<h3 id="debian">Debian</h3>
<p>Desde un terminal como root:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>apt-get install libpam-cracklib</span></span></code></pre></div>
<h3 id="redhat">RedHat</h3>
<p>El módulo PAM Cracklib viene por defecto en la instalación, no tendremos que hacer nada.</p>
<h2 id="ficheros-implicados">Ficheros implicados</h2>
<h3 id="debian-1">Debian</h3>
<pre tabindex="0"><code>/etc/pam.d/common-password: aquí configuramos las reglas que se aplican en las contraseñas.
/etc/login.defs: aquí definimos el periodo de expiración de las contraseñas.
</code></pre><h3 id="redhat-1">RedHat</h3>
<pre tabindex="0"><code>/etc/security/pwquality.conf: aquí configuramos las reglas que se aplican en las contraseñas.
/etc/pam.d/system-auth: aquí definimos las últimas contraseñas, las cuales no serán reutilizables.
/etc/login.defs: aquí definimos el periodo de expiración de las contraseñas.
</code></pre><h2 id="configuración">Configuración</h2>
<p>Ahora aplicaremos una configuración al sistema el objetivo de aplicar la política:</p>
<ul>
<li>Longitud mínima de 10 caracteres.</li>
<li>Al menos un valor en mayúscula.</li>
<li>Al menos un valor en minúscula.</li>
<li>Al menos un carácter numérico.</li>
<li>Al menos un carácter especial.</li>
<li>No se pueden repetir las 5 últimas contraseñas.</li>
<li>Que al menos cambien 3 caracteres en la nueva contraseña con respecto a la anterior.</li>
<li>Bloquear al introducir la credencial 3 veces erróneamente.</li>
<li>Caducidad cada 90 días.</li>
<li>Que advierta 15 días antes de la caducidad.</li>
</ul>
<h3 id="valores-positivos-y-negativos">Valores positivos y negativos</h3>
<p>Los valores que se utilizan en la configuración pueden ser positivos o negativos.</p>
<ul>
<li>Positivos: deben de contener el número de caracteres indicados en su valor.</li>
<li>Negativos: deben de contener al menos el número de caracteres indicados en su valor.</li>
</ul>
<p>Un ejemplo de un valor de 2 para la configuración de caracteres mayúsculas, esto indica que dos valores tienen que ser  mayúsculas, y un valor de -2 indica al menos dos deben ser mayúsculas.</p>
<h3 id="debian-2">Debian</h3>
<p>En Debian aplicamos los parámetros del siguiente modo:</p>
<p>Editamos el archivo /etc/pam.d/common-password donde configuramos la complejidad de las contraseña.</p>
<p>Añadimos los siguientes valores a la línea que contiene pam_cracklib.so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>password        requisite                       pam_cracklib.so retry<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> minlen<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span> difok<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> lcredit<span style="color:#f92672">=</span>-1 ucredit<span style="color:#f92672">=</span>-1 dcredit<span style="color:#f92672">=</span>-1 ocredit<span style="color:#f92672">=</span>-1</span></span></code></pre></div>
<p>También agregamos el parámetro remember a la línea que contiene pam_unix.so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>password        <span style="color:#f92672">[</span>success<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> default<span style="color:#f92672">=</span>ignore<span style="color:#f92672">]</span>      pam_unix.so obscure use_authtok try_first_pass sha512 remember<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span></span></span></code></pre></div>
<p>Editamos el archivo /etc/login.defs para configurar los parámetros temporales de caducidad y advertencia:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>PASS_MAX_DAYS <span style="color:#ae81ff">90</span>
</span></span><span style="display:flex;"><span>PASS_MIN_DAYS <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>PASS_WARN_AGE <span style="color:#ae81ff">15</span></span></span></code></pre></div>
<h3 id="fedora">Fedora</h3>
<p>En Fedora aplicamos los parámetros del siguiente modo:</p>
<p>Editando el archivo /etc/security/pwquality.conf para configurar los valores de complejidad:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>retry<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>minlen<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>difok<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>lcredit<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>credit<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>dcredit<span style="color:#f92672">=</span>-1
</span></span><span style="display:flex;"><span>ocredit<span style="color:#f92672">=</span>-1</span></span></code></pre></div>
<p>Después indicamos el número de últimas contraseñas que serán recordadas para no reutilizar, editando el archivo /etc/pam.d/system-auth y agregamos el parámetro remember a la siguiente línea:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>password suficient        pam_unix.so sha512 shadow nullok try_first_pass use_authok remember<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span></span></span></code></pre></div>
<p>Y por ultimo editamos el archivo /etc/login.defs para configurar los parámetros temporales de caducidad y advertencia:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>PASS_MAX_DAYS <span style="color:#ae81ff">90</span>
</span></span><span style="display:flex;"><span>PASS_MIN_DAYS <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>PASS_WARN_AGE <span style="color:#ae81ff">15</span></span></span></code></pre></div>
<h3 id="significado-de-los-valores">Significado de los valores</h3>
<p>Los valores indican:</p>
<ul>
<li>retry: número de intentos Fallidos.</li>
<li>minlen: longitud mínima.</li>
<li>difok: número de caracteres distintos con respecto a la contraseña anterior.</li>
<li>lcredit: número de caracteres minúscula.</li>
<li>ucredig: número de caracteres mayúscula.</li>
<li>dcredit: número de caracteres numéricos.</li>
<li>ocredit: número de caracteres especiales.</li>
<li>remember: el total de las últimas contraseñas que no se podrán reutilizar.</li>
</ul>
<p>Los valores temporales:</p>
<ul>
<li>PASS_MAX_DAYS: máximo número de días en los que la contraseña será válida desde el último cambio.</li>
<li>PASS_MIN_DAYS: indica el número de días que han de transcurrir entre un cambio de contraseña y el siguiente.</li>
<li>PASS_WARN_AGE: indica desde cuando se comenzará a mostrar el mensaje de advertencia previo a la caducidad.</li>
</ul>
<h3 id="para-tener-en-cuenta">Para tener en cuenta</h3>
<p>Las configuraciones que controlan los límites de tiempo solo aplica a los nuevos usuarios creados después a la aplicación de la, con lo cual no afecta a los usuarios ya existentes. Para aplicarle los valores configurados debemos de utilizar manualmente el comando chage.</p>
<p>Esto mismo sucede si en un momento determinado cambiamos la política de tiempo.</p>
<p>Por el contrario los cambios que realizamos en las características de las contraseña se aplicaran en el momento, y es extensible a todos los usuarios actuales y futuros.</p>
<h2 id="chequeando-los-cambios">Chequeando los cambios</h2>
<p>Utilizaremos desde un terminal como root el comando chage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>chage -l test</span></span></code></pre></div>
<p>Último cambio de contraseña                    :abr 15, 2021
La contraseña caduca                    : jul 14, 2021
Contraseña inactiva                    : nunca
La cuenta caduca                        : nunca
Número de días mínimo entre cambio de contraseña        : 0
Número de días máximo entre cambio de contraseña        : 90
Número de días de aviso antes de que caduque la contraseña    : 15</p>
<p>Si queremos aplicar los cambios anteriores manualmente lo hacemos utilizando el comando de la siguinte manera desde el terminal como root:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>chage test -W <span style="color:#ae81ff">15</span> -M <span style="color:#ae81ff">90</span> -m <span style="color:#ae81ff">0</span></span></span></code></pre></div>
<p>En este los parámetros son:</p>
<ul>
<li>-W: tiempo en el que se muestra la advertencia previo a la caducidad, en días.</li>
<li>-M: tiempo máximo de caducidad de la contraseña, en días.</li>
<li>-m: número de días que han de transcurrir entre un cambio de contraseña y el siguiente.</li>
</ul>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/terminal/" rel="tag">Terminal</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/seguridad/" rel="tag">Seguridad</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="JaimeAlberto avatar" src="/img/avatar.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">Sobre el autor JaimeAlberto</span>
	</div>
	<div class="authorbox__description">
		The BOFH of this Site
	</div>
</div>



			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
<div class="footer__links">
	<a class="footer__link" href="/licencia/">Licencia CC BY-NC-SA 4.0</a>
</div>
		<div class="footer__copyright">
			&copy; 2022 JaimeAlberto.
			<span class="footer__copyright-credits">Generado con <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> y <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a>.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>