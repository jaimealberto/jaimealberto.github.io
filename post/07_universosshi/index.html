<!DOCTYPE html>
<html class="no-js" lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Universo Ssh I - </title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Primer post sobre todo lo relacionado con Ssh">
		<meta property="og:title" content="Universo Ssh I" />
<meta property="og:description" content="Primer post sobre todo lo relacionado con Ssh" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jaimealberto.github.io/post/07_universosshi/" />
<meta property="article:published_time" content="2021-08-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-08-04T00:00:00+00:00" />

		<meta itemprop="name" content="Universo Ssh I">
<meta itemprop="description" content="Primer post sobre todo lo relacionado con Ssh">
<meta itemprop="datePublished" content="2021-08-04T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-08-04T00:00:00+00:00" />
<meta itemprop="wordCount" content="2348">



<meta itemprop="keywords" content="SO,Terminal,Cliente,Utilidades," />

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/logo.png">
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menú</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">La causa ...</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/aboutme/">
				
				<span class="menu__text">Algo sobre mí ...</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/">
				
				<span class="menu__text">Posts</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/combos/">
				
				<span class="menu__text">Combos</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/raspberrypi/">
				
				<span class="menu__text">Raspberry Pi</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/vida/">
				
				<span class="menu__text">Vidas</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/recetas/">
				
				<span class="menu__text">Recetas</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/recursos/">
				
				<span class="menu__text">Recursos</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Universo Ssh I</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">JaimeAlberto</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2021-08-04T00:00:00Z">04-08-2021</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/ssh/" rel="category">Ssh</a>, <a class="meta__link" href="/categories/redes/" rel="category">Redes</a>
	</span>
</div></div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Índice</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#administración-remota">Administración remota</a></li>
    <li><a href="#transferencia-de-archivos">Transferencia de archivos</a>
      <ul>
        <li><a href="#scp">Scp</a></li>
        <li><a href="#sftp">Sftp</a></li>
      </ul>
    </li>
    <li><a href="#sistema-de-archivos-remoto">Sistema de archivos remoto</a></li>
    <li><a href="#llaves">Llaves</a>
      <ul>
        <li><a href="#generar-identidad-las-llaves">Generar identidad, las llaves</a></li>
        <li><a href="#distribución-de-las-llaves-a-los-servidores">Distribución de las llaves a los servidores</a></li>
      </ul>
    </li>
    <li><a href="#configuración">Configuración</a></li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<figure>
    <img src="/img/ssh.jpg"/> 
</figure>

<p>Dentro de lo que conocemos como ssh, a parte de ser en la nomenclatura de la <a href="https://es.wikipedia.org/wiki/C%C3%B3digo_de_aeropuertos_de_IATA">IATA</a> del aeropuerto internacional <a href="https://es.wikipedia.org/wiki/Aeropuerto_Internacional_de_Sharm_el-Sheij">Sharm el-sheij</a>, es un protocolo de comunicaciones el cual se apoyan muchas herramientas no solo ssh como herramienta. Trabaja de forma parecida a telnet, pero impedimenta una seguridad basada en un sistema de intercambio de llaves seguro. Este sistema identifica la identidad de ambos extremos de la comunicación e implementa varios tipos de cifrado mediante un tunel impidiendo que los amigos de lo ajeno se apropien de lo trasmitimos en nuestras comunicaciones. No obstante como ya sabemos nada es !00% seguro, por medio de ataques de <a href="https://es.wikipedia.org/wiki/Ataque_de_REPLAY">REPLAY</a> se puede atacar. Pero nos da cierta seguridad, la cual podemos aumentar con medidas adicionales.</p>
<p>Como en todos los procesos de comunicación tenemos un cliente y un servidor. Lo mas utilizado es un ssh cliente en un extremo y conectar a un servidor para una gestión remota de host los cuales pueden ser servidores, routers, switches, etc. En una serie de artículos nos iremos adentrando por este mundo que nos permite realizar muchas tareas no solo la anteriormente descrita. Sin mas vueltas vamos al lio ya. Algún purista dirá que en articulo falta hablar de conceptos como cifrado asimétrico, hashing, etc. Pero prefiero que sea lo mas practico posible.</p>
<h2 id="administración-remota">Administración remota</h2>
<p>El comando ssh esta ampliamente extendido en cualquiera de los sistemas operativos de la familia *nix ( Linux, Bsd, Unix, etc ). En sistemas Windows es necesario instalar un cliente, entre los mas populares esta <a href="https://www.putty.org/">PuTTY</a>. Pero existen muchísimos mas, para gustos los colores.Lo mas habitual es su utilización para conseguir una <a href="https://es.wikipedia.org/wiki/Shell_de_Unix">Shell</a>remota, por ejemplo, de la siguiente manera:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ssh usuario@host_remmoto</code></pre></div>
<pre><code>host_remoto Nombre si un dns resuelve o bien dirección ip
</code></pre><p><strong>Nota:</strong> si no se indica usuario se utilizara el que se este logueado en el host desde el que se inicia la comunicación.</p>
<p>Al cliente se le pueden indicar varios parámetros, los mas habituales son:</p>
<pre><code>-p Puerto, por defecto el 22
-4 Fuerza a utilizar IPv4
-6 Fuerza a utilizar IPv6
-B Si tenemos varios interfaces red, indicamos cual utilizar
-b Si tenemos varias direcciones de red, indicamos cual utilizar
-l Usuario, otro modo de indicar el usuario sin @
-t Asignación de un tty remoto para ejecución
-V Muestra la versión
-v Modo depuración, en el caso se tener errores, máximo 3
</code></pre><p>Ahora vamos a ver una serie de ejemplos de uso para nuestro día a día.</p>
<p>Conexión añadiendo utilizando varios parámetros:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ssh -p <span style="color:#ae81ff">2020</span> -l usuario 192.168.1.25</code></pre></div>
<p>Nos conectamos por el puerto 2020 a la ip 192.168.1.25 con el nombre de usuario “usuario”.</p>
<p>Ssh también nos permite la ejecucion de comandos remota de la siguiente manera:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ssh usuario@host_remmoto comando_ejecutar</code></pre></div>
<p>Si la ejecución remota necesita asignación de un tty, si por ejemplo utilizamos mc es necesario añadir el modificador -t, ejemplo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ssh usuario@&lt;host_remmoto&gt; mc</code></pre></div>
<p>Con este comando estaremos ejecutando <a href="https://midnight-commander.org/">Midnight Commander</a> en el host remoto. Tener en cuenta que el software que ejecutemos tiene que estar instalado en el host remoto.</p>
<p>El uso del cliente de Ssh desde el terminal nos ofrece cantidad de posibilidades, el tope nuestra imaginación y necesidades. Se pueden hacer cosas muy útiles e interesantes como:</p>
<p>Probar rendimiento de la red en tiempo real:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">yes | pv | ssh usuario@&lt;host_remmoto&gt; <span style="color:#e6db74">&#34;cat &gt; /dev/null&#34;</span></code></pre></div>
<p><strong>Nota:</strong> Lo cortamos con ctrl+c, es continuo si no.</p>
<p>Podemos comparar un archivo local con uno remoto:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ssh usuario@&lt;host_remmoto&gt; <span style="color:#e6db74">&#34;cat archivo_remoto&#34;</span> | diff – archivo_local</code></pre></div>
<p><strong>Nota:</strong> Importante respetar las comillas en la ejecución de cat.</p>
<p>Gestión de paquetes rpm / yum :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ssh root@&lt;host_remoto&gt; <span style="color:#e6db74">&#39;rpm -qa&#39;</span> | xargs yum -y install</code></pre></div>
<p>Gestión de paquetes deb :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ssh root@&lt;host_remoto&gt; <span style="color:#e6db74">&#39;dpkg --get-selections&#39;</span> | dpkg --set-selections <span style="color:#f92672">&amp;&amp;</span> dselect install</code></pre></div>
<p>De este modo podemos recuperar sesiones remotas utilizando <a href="http://www.gnu.org/software/screen/">Screen</a>, monitorizar un sistema mediante <a href="http://nmon.sourceforge.net/">Nmon</a>, editar archivos remotos, instalar software remotamente, analizar trafico mediante <a href="https://www.wireshark.org/docs/man-pages/tshark.html">Tshark</a>y capturarlo en un archivo local, etc. Prácticamente lo cualquier cosa que se nos ocurra. Yo por ejemplo en mi archivo .zshrc, utilizo como <a href="https://es.wikipedia.org/wiki/Shell_de_Unix">Shell</a> <a href="https://es.wikipedia.org/wiki/Zsh">Zsh</a>, alguno de los alias que tengo para mi trabajo diario son:</p>
<pre><code>alias h1nmon=&quot;ssh -t host1 'nmon'&quot;
alias h1vtop=&quot;ssh -t host1 'vtop'&quot;
alias h1auth=&quot;ssh -t host1 'tail -f /var/log/auth.log | ccze'&quot;
</code></pre><p><strong>Nota:</strong> host1 es un alias configurado previamente en el cliente, configuración que veremos mas adelante.</p>
<h2 id="transferencia-de-archivos">Transferencia de archivos</h2>
<p>La transferencia de archivos utilizando protocolo Ssh es común por muchos motivos, los dos principales seguridad y portabilidad de la solución. Desde el terminal se realiza básicamente de manera interactiva y no interactiva. Para ello el cliente de terminal cuenta con los comandos scp y sftp. A continuación veremos su funcionamiento básico y algún truco que otro.</p>
<h3 id="scp">Scp</h3>
<p>El comando scp nos permite la copia de archivos desde un origen a un destino utilizando protocolo Ssh sin poder interactuar. Su uso básico desde un terminal es el siguiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">scp &lt;parámetro&gt; &lt;origen&gt; &lt;destino&gt;</code></pre></div>
<p>A continuación vamos a ver varios ejemplos para comprender mejor su funcionamiento y a su vez ver como nos puede ayudar en nuestro trabajo diario.</p>
<p>Copia de local a remoto, archivo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">scp mi_archivo.txt usuario_remoto@host_remoto:/home/usuario_remoto/</code></pre></div>
<p>Copia de remoto a local, archivo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">scp usuario_remoto@host_remoto:/home/usuario_remoto/mi_archivo.txt home/usuario_local/</code></pre></div>
<p>Para copiar directorios añadimos el parámetro -r en cualquiera de los dos casos. Podemos aplicar comodines para indicar que copiar, o bien trabajar con . para  indicar la directorio donde se ejecuta el comando. Vamos a ver un ejemplo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">scp -r /home/mi_usuario/ usuario_remoto@host_remoto:/home/usuario_remoto/tmp</code></pre></div>
<p>Con el comando anterior copiamos el home de nuestro usuario y todo su contenido recursiva mente al host remoto en un directorio llamado tmp del home de usuario remoto.</p>
<p>Una de las partes mas interesantes del funcionamiento de scp es que donde se dice origen y destino pueden ser host remotos, no es un condicionante que el alguno de los dos campos tenga que ser el host loca. Es decir si tenemos la necesidad de copiar algo entre dos host remotos al nuestro donde estamos actualmente no tendremos que copiar del host remoto A a nuestro host local y luego de nuestro host local al host remoto B. Vamos a ver un ejemplo para entender esto mejor:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">scp usuario_remoto1@host_remoto1:/directorio/archivo.txt usuario_remoto2@host_remoto2:/directorio/</code></pre></div>
<p>Con el comando anterior estamos ordenando desde nuestro host que se copie archivo.txt del host remoto A la host remoto B. Esto también es aplicable a lo visto anteriormente con directorios y de manera recursiva también.</p>
<p>Otro caso interesante es si queremos copiar solo dos o tres archivos y no podemos utilizar comodines o no queremos hacerlo. Simplemente los separamos con un espacio. Vamos a ver un ejemplo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">scp archivo1.txt informe.odt imagen.png usuario_remoto@host_remoto:/directorio/</code></pre></div>
<p>Esto copia archivo1.txt informe.odt e imagen.png al host remoto en directorio.</p>
<p>Todo esto es aplicable también a directorios. Podemos combinar todo lo anterior como queramos, el limite nuestra imaginación o necesidad.</p>
<p>Resumen parámetros mas utilizados:</p>
<pre><code>-r Recursivo. 
-P Puerto, por defecto 22.
-p Conserva atributos del origen de la copia.
-c Algoritmo de cifrado, por defecto Triple-DES.
-l Limitamos el ancho de banda a Kbits/s. Por defecto no tiene limite.
-4 Forzamos al uso de IPv4.
-4 Forzamos al uso de IPv6.
-v Activamos modo verbose, por si necesitamos diagnosticar un problema.
-C Habilita la compresión en la transferencia. Por defecto no lo hace.
</code></pre><p><strong>Nota:</strong> Existe diferencia entre los parámetros en las mayusculas y minúsculas.</p>
<h3 id="sftp">Sftp</h3>
<p>El comando sftp es el que nos permite conectar con el servidor e interactuar con el. Lo primero es conectar con el servidor de la siguiente naneara:</p>
<p>sftp usuario@host_remoto</p>
<p>Esto nos proporciona shell interactiva. Una vez ya conectados lo mejor es teclear help o ?, es lo mismo. Lo cual nos muestra los comandos disponibles para empezar a interactuar. No todos los servidores tienen los mismos. Los mas comunes son:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">sftp&gt;help

bye,quit,exit	Cualquiera de los tres nos permite salir del servidor.
cd        Cambiar de directorio remoto.
df        Nos muestra el las estadísticas del directorio actual
get       Descarga archivo.
lcd       Cambia de directorio local.
lls       List contenido local.
lmkdir    Crea directorio local.
lpwd      Muestra directorio local.
ls        Lista contenido del del servidor.
mkdir     Crea directorio en el servidor.
progress  Activa la barra de proceso para la ejecución de comandos.
put       Sube archivo al servidor.
pwd       Muestra directorio actual remoto.
rm        Borra archivo remoto.
rmdir     Borra directorio remoto.
version   Muestra información sobre la versión.
!command  Ejecuta ‘command’ en la shell local.</code></pre></div>
<h2 id="sistema-de-archivos-remoto">Sistema de archivos remoto</h2>
<p>En la mayoría de los sistemas *nix ( Linux, MacOs, BSD, etc ) tenemos como herramienta disponible para nuestro terminal sshfs, el cual nos permite montar mediante protocolo Ssh un directorio remoto en un directorio local. Su uso desde el terminal es el siguiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">sshfs usuario@host_remoto:/directorio_remoto /directorio_local &lt;parámetros&gt;</code></pre></div>
<p>Los parámetros mas habituales son:</p>
<pre><code>-p Puerto si no se usa el estándar.
-C Usar compresión.
</code></pre><h2 id="llaves">Llaves</h2>
<p>Después de leer todo lo anterior suelen surgir una serie de dudas o tu mente inquieta  a divagar.</p>
<ul>
<li>Y si pudiera automatizar cosas, pero no seria seguro poner contraseñas en los scripts.</li>
<li>Que molesto es teclear siempre las contraseñas, alguna manera segura de automatizar el proceso a autenticación tiene que existir.</li>
<li>Me gustaría que alguien se conectara  sin usuario y contraseña.</li>
<li>El utilizar usuario y password se esta quedando obsoleto, alguna otra manera de hacer esto tiene que existir.</li>
</ul>
<p>Estas son algunas de las preguntas que te pueden asaltar, pues bien si todo esto y mucho mas se puede hacer. Como ?, pues mediante la gestión de identidades utilizando llaves. Ahora vamos a ver como hacer esto y luego como utilizarlas.</p>
<h3 id="generar-identidad-las-llaves">Generar identidad, las llaves</h3>
<p>Ahora vamos a proceder a generar nuestra identidad. La cual esta compuesta de dos llaves. Una publica que es la que tendremos que distribuir a los servidores que nos proporcionen acceso a servicios vía Ssh y una privada  que la guardaremos a buen recaudo.</p>
<p>Para generar nuestras llaves utilizaremos la siguiente linea de comando desde nuestro home de usuario en un terminal:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ssh-keygen -b <span style="color:#ae81ff">4096</span> -t rsa -C <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>whoami<span style="color:#66d9ef">)</span><span style="color:#e6db74">@</span><span style="color:#66d9ef">$(</span>hostname<span style="color:#66d9ef">)</span><span style="color:#e6db74">-</span><span style="color:#66d9ef">$(</span>date -I<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span></code></pre></div>
<p>Aqui se puede observar el proceso:</p>
<figure>
    <img src="/img/generatekey.gif"/> 
</figure>

<p>Explicación de los parámetros utilizados:</p>
<pre><code>ssh-keygen Comando que genera el par de llaves.
-b 4096    Tamaño de clave simétrica sea de de 4096 bits.
-t rsa     Algoritmo que utilizaremos para generar el par de llaves.
-C         Inserta un comentario.«$(whoami)@$(hostname)-$(date -I)», opcional.
</code></pre><p>Después de ejecutar el comando, nos preguntará donde queremos guardar las llaves y su nombre. Presionaremos la tecla Enter, dejamos las opciones por defecto, Las llaves se guardarán en el directorio estándar donde esta nuestra configuración de Ssh, que es /home/usuario/.ssh/, y tendrán el nombre estándar.</p>
<p>A continuación nos preguntará si queremos introducir una contraseña para cifrar nuestra clave privada. Como nuestro objetivo conectarnos sin necesidad de introducir ninguna contraseña, presionamos Enter sin introducir ninguna.</p>
<p>Al final nos pregunta que volvamos a introducir la contraseña anterior,como no introducimos ninguna volvemos a presionar Enter.</p>
<p><strong>Nota:</strong> Al no teclear una contraseña, la llave privada se almacena guarda en nuestro disco duro sin cifrar. Esto es un riesgo de seguridad. Por este motivo tendremos que ponerla a buen recaudo, podemos cifrar el disco o utilizar ssh-agent con contraseña, entre otras contramedidas. Una vez finalizado el proceso se crearan las llaves en nuestro directorio que almacena nuestra configuración ~/.ssh.</p>
<h3 id="distribución-de-las-llaves-a-los-servidores">Distribución de las llaves a los servidores</h3>
<p>Para copiar nuestra llave publica utilizaremos la siguiente linea de comando desde nuestro home de usuario en un terminal:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ssh-copy-id usuario@host_remoto</code></pre></div>
<p>Parámetros :</p>
<pre><code>ssh-copy-id Comando que copia la llaves
-i          Indica el archivo de la llave, si fuera necesario
-p          Puerto, por si no fuera el estándar
</code></pre><p>Yo personalmente prefiero utilizar <a href="http://magic-wormhole.io/">Magic-Wormhole</a> para el intercambio de llaves. Esto lo explicare en otro post.</p>
<h2 id="configuración">Configuración</h2>
<p>La configuración de las herramientas de uso del terminal relacionadas protocolo Ssh ( ssh, scp, sftp, etc ) se almacenan en el directorio .ssh de cada usuario. Dentro de este directorio podemos encontrar varios archivos:</p>
<pre><code>id_rsa.pub  Llave publica
id_rsa      Llave privada
known_hosts Lista de llaves publicas conocidas
</code></pre><p>Bien ahora vamos a añadir un archivo con el nombre config, el cual nos servirá para crear alias, parámetros comunes a uso de las herramientas de terminal, etc, entre otras cosas. Las cuales nos facilitara el trabajo diario. Vamos a ver un ejemplo y comentarlo:</p>
<p>Añadiremos el siguiente bloque al principio del archivo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#75715e">### configuración por defecto para todas las conexiones ##</span>
<span style="color:#a6e22e">Host *</span>
     <span style="color:#a6e22e">User sistemas</span>
     <span style="color:#a6e22e">Port 22</span>
     <span style="color:#a6e22e">Protocol 2</span>
     <span style="color:#a6e22e">IdentityFile ~/.ssh/id_rsa</span>
     <span style="color:#a6e22e">IdentitiesOnly yes</span>
     <span style="color:#a6e22e">ServerAliveInterval 60</span>
     <span style="color:#a6e22e">ServerAliveCountMax 30</span></code></pre></div>
<p><strong>Nota:</strong> el símbolo ~ es path del home de usuario.</p>
<p>Vamos a ir revisando y explicando cada linea del bloque:</p>
<pre><code>#:                   Nos permite añadir comentarios, no se procesa.
Host:                Define para qué host o hosts se aplica la sección, podemos utilizar comodines como expresión regular (*,!,?). La sección termina con una nueva sección de Host.
User:                Usuario que se utilizara para la conexión.
Port:                Puerto que se utilizara para la conexión.
Protocol:            Versión del protocolo.
IdentityFile:        Especifica la llave de autenticación.
IdentitiesOnly:      Indica que Ssh solo debe usar los archivos de identidad de autenticación, se utiliza por defecto para uso con múltiples identidades.
ServerAliveInterval: Establece un intervalo de tiempo de espera en segundos después del cual, si no se han recibido datos del servidor, evita corte por inactividad.
ServerAliveCountMax: Establece el número veces que se repetirá e “ServerAliveInterval”.
</code></pre><p>Una vez que tenemos los parámetros globales, al utilizar *, vamos a añadir bloques de host con configuraciones especificas. Veremos varios ejemplos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#75715e">## Alias host server1 si coincide algún parámetro general anterior sobre escribe ##</span>
<span style="color:#a6e22e">Host server1</span>
     <span style="color:#a6e22e">Hostname 10.0.34.10</span>
     <span style="color:#a6e22e">User lobezno</span>
     <span style="color:#a6e22e">Port 4242</span>
     <span style="color:#a6e22e">IdentityFile /nfs/shared/users/lobezno/keys/server1/id_rsa</span></code></pre></div>
<p>Que cambia o añade al bloque general:</p>
<pre><code>Hostname:     Indica la ip o nombre de dns al que se conecta.
User:         Indica un usuario especifico distinto al general.
Port:         Indica un puerto especifico distinto al general.
IdentityFile: Indica una llave distinta a la general.
</code></pre><p>Como se puede observar podemos realizar configuraciones globales o bien especificas según necesidades. Se puede jugar con una gran cantidad de parámetros . Para realizar esta tarea si disponemos de un entorno grafico, no siempre es así, tenemos herramientas como SSH Config Editor para MacOs. Pero nunca esta de mas saber como funciona el archivo para poder sacar el máximo partido. Como consejo final es importante comentar todo lo que se pueda el archivo, que luego tenemos que tocar algo y no sabemos el por que de un parámetro o valor.</p>
<p><a href="https://hejki.org/ssheditor/">SSH Config Editor</a></p>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/so/" rel="tag">SO</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/terminal/" rel="tag">Terminal</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/cliente/" rel="tag">Cliente</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/utilidades/" rel="tag">Utilidades</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="JaimeAlberto avatar" src="/img/avatar.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">Sobre el autor JaimeAlberto</span>
	</div>
	<div class="authorbox__description">
		The BOFH of this Site
	</div>
</div>



			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
<div class="footer__links">
	<a class="footer__link" href="/licencia/">Licencia CC BY-NC-SA 4.0</a>
</div>
		<div class="footer__copyright">
			&copy; 2025 JaimeAlberto.
			<span class="footer__copyright-credits">Generado con <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> y <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a>.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>